<view class="certification-container">

  <!-- 认证类型切换 -->
  <view class="cert-tabs">
    <view class="tab-item {{currentTab === 'personal' ? 'active' : ''}}" bindtap="switchTab" data-tab="personal">
      个人认证
    </view>
    <view class="tab-item {{currentTab === 'enterprise' ? 'active' : ''}}" bindtap="switchTab" data-tab="enterprise">
      企业认证
    </view>
  </view>

  <!-- 个人认证内容 -->
  <view class="personal-cert" wx:if="{{currentTab === 'personal'}}">
    <!-- 认证步骤 -->
    <view class="cert-steps">
      <view class="step-item {{currentStep === 'photo' ? 'active' : ''}}" bindtap="goToStep" data-step="photo">
        <view class="step-content-wrapper">
          <view class="step-icon">📷</view>
          <text class="step-text">形象照片</text>
        </view>
      </view>
      <view class="step-line"></view>
      <view class="step-item {{currentStep === 'basic' ? 'active' : ''}}" bindtap="goToStep" data-step="basic">
        <view class="step-content-wrapper">
          <view class="step-icon">📋</view>
          <text class="step-text">基础信息</text>
        </view>
      </view>
      <view class="step-line"></view>
      <view class="step-item {{currentStep === 'identity' ? 'active' : ''}}" bindtap="goToStep" data-step="identity">
        <view class="step-content-wrapper">
          <view class="step-icon">🆔</view>
          <text class="step-text">身份认证</text>
        </view>
      </view>
    </view>

    <!-- 步骤1: 形象照片 -->
    <view class="step-content" wx:if="{{currentStep === 'photo'}}">
      <view class="upload-section">
        <text class="section-title">上传形象照片</text>
        <view class="main-upload-area" bindtap="uploadPhoto">
          <image wx:if="{{photoImage}}" class="main-uploaded-image" src="{{photoImage}}"></image>
          <view wx:else class="main-upload-placeholder">
            <image class="placeholder-avatar" src="/images/avatars/default-avatar.svg"></image>
          </view>
          <view wx:if="{{photoImage}}" class="delete-main-photo" catchtap="deleteMainPhoto">×</view>
        </view>
        <view class="thumbnail-grid">
          <view class="thumbnail-item" wx:for="{{uploadedImages}}" wx:key="index">
            <image class="thumbnail-image" src="{{item}}" bindtap="previewThumbnail" data-index="{{index}}"></image>
            <view class="delete-icon" catchtap="deleteThumbnail" data-index="{{index}}">×</view>
          </view>
          <view class="thumbnail-item add-thumbnail" bindtap="addMoreImages">
            <text class="add-icon">+</text>
          </view>
        </view>
        <text class="upload-tip">支持格式：.jpg .png .svg .gif，单个文件不超过5MB</text>
      </view>
      <view class="next-btn" bindtap="goToNextStep">
        提交并下一步
      </view>
    </view>
    
    <!-- 步骤2: 基础信息 -->
    <view class="step-content" wx:if="{{currentStep === 'basic'}}">
      <view class="form-section">
        
        <view class="name-gender-row">
          <view class="form-item name-item">
            <text class="form-label">姓名</text>
            <input class="form-input" placeholder="请输入真实姓名" data-field="name" bindinput="inputChange" value="{{certData.name}}" />
          </view>
          
          <view class="form-item gender-item">
            <text class="form-label">性别</text>
            <view class="gender-selector">
              <view class="gender-option {{certData.gender === '男' ? 'selected' : ''}}" bindtap="selectGender" data-gender="男">男</view>
              <view class="gender-option {{certData.gender === '女' ? 'selected' : ''}}" bindtap="selectGender" data-gender="女">女</view>
            </view>
          </view>
        </view>
        
        <view class="form-item">
          <text class="form-label">所在地区</text>
          <picker mode="region" bindchange="regionChange" value="{{region}}">
            <view class="picker-input {{!region[0] ? 'placeholder' : ''}}">
              {{region[0] ? region[0] + ' ' + region[1] + ' ' + region[2] : '请选择所在地区'}}
              <view class="picker-arrow">▾</view>
            </view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">身份选择</text>
          <picker bindchange="identityTypeChange" value="{{identityTypeIndex}}" range="{{identityTypes}}">
            <view class="picker-input {{!identityTypes[identityTypeIndex] ? 'placeholder' : ''}}">
              {{identityTypes[identityTypeIndex] || '请选择身份类型'}}
              <view class="picker-arrow">▾</view>
            </view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">职称职务</text>
          <input class="form-input search-input" placeholder="输入关键词搜索" data-field="jobTitle" bindinput="inputChange" value="{{certData.jobTitle}}" />
        </view>
        
        <view class="form-item">
          <text class="form-label">擅长领域</text>
          <input class="form-input search-input" placeholder="输入关键词搜索" data-field="expertise" bindinput="inputChange" value="{{certData.expertise}}" />
        </view>
        
        <view class="form-item">
          <text class="form-label">所在企业</text>
          <input class="form-input search-input" placeholder="输入关键词搜索机构名称" data-field="company" bindinput="inputChange" value="{{certData.company}}" />
        </view>
        
        <view class="form-item" wx:if="{{!certData.company}}">
          <view class="company-not-found">未搜索到机构请填写企业名称</view>
        </view>
      </view>
      
      <view class="next-btn" bindtap="goToNextStep">
        提交并下一步
      </view>
    </view>
    
    <!-- 步骤3: 身份认证 -->
    <view class="step-content" wx:if="{{currentStep === 'identity'}}">
      <view class="form-section">
        <!-- VIP嘉宾选项 -->
        <view class="vip-section">
          <view class="vip-checkbox {{certData.isVip ? 'checked' : ''}}" bindtap="toggleVip">
            <text class="checkbox-icon">{{certData.isVip ? '✓' : ''}}</text>
          </view>
          <text class="vip-label">我是VIP嘉宾</text>
          <input class="vip-code-input" placeholder="请填写VIP嘉宾码" data-field="vipCode" bindinput="inputChange" value="{{certData.vipCode}}" />
        </view>
        
        <!-- 身份证上传 -->
        <view class="cert-upload-section">
          <text class="upload-section-title">请上传身份证</text>
          <text class="upload-tip">支持jpg/png格式，文件大小在2M以内</text>
          
          <view class="cert-upload-grid">
            <view class="cert-upload-item">
              <view class="personal-id-upload-area" bindtap="uploadIdFront">
                <image wx:if="{{certData.idFrontImage}}" class="cert-uploaded-image" src="{{certData.idFrontImage}}"></image>
                <view wx:else class="cert-upload-placeholder">
                  <image class="cert-placeholder-icon" src="/images/id-front-icon.svg"></image>
                </view>
              </view>
              <text class="cert-upload-label">上传正面</text>
            </view>
            
            <view class="cert-upload-item">
              <view class="personal-id-upload-area" bindtap="uploadIdBack">
                <image wx:if="{{certData.idBackImage}}" class="cert-uploaded-image" src="{{certData.idBackImage}}"></image>
                <view wx:else class="cert-upload-placeholder">
                  <image class="cert-placeholder-icon" src="/images/id-back-icon.svg"></image>
                </view>
              </view>
              <text class="cert-upload-label">上传反面</text>
            </view>
          </view>
        </view>
        
        <!-- 医师资格证和传资格证书 -->
        <view class="cert-upload-section">
          <view class="cert-upload-grid">
            <view class="cert-upload-item">
              <text class="upload-section-title">请上传医师资格证</text>
              <view class="personal-cert-upload-area" bindtap="uploadDoctorCert">
                <image wx:if="{{certData.doctorCertImage}}" class="cert-uploaded-image" src="{{certData.doctorCertImage}}"></image>
                <view wx:else class="cert-upload-placeholder">
                  <text class="cert-placeholder-text">医师资格证</text>
                </view>
              </view>
            </view>
            
            <view class="cert-upload-item">
              <text class="upload-section-title">请上传资格证书</text>
              <view class="personal-cert-upload-area" bindtap="uploadQualificationCert">
                <image wx:if="{{certData.qualificationCertImage}}" class="cert-uploaded-image" src="{{certData.qualificationCertImage}}"></image>
                <view wx:else class="cert-upload-placeholder">
                  <image class="cert-placeholder-icon" src="/images/cert-icon.svg"></image>
                </view>
              </view>
            </view>
          </view>
        </view>
        
        <!-- 其他证书 -->
        <view class="cert-upload-section">
          <view class="cert-upload-grid">
            <view class="cert-upload-item">
              <text class="upload-section-title">请上传其他证书</text>
              <view class="personal-cert-upload-area" bindtap="uploadOtherCert1">
                <image wx:if="{{certData.otherCert1Image}}" class="cert-uploaded-image" src="{{certData.otherCert1Image}}"></image>
                <view wx:else class="cert-upload-placeholder">
                  <image class="cert-placeholder-icon" src="/images/cert-icon.svg"></image>
                </view>
              </view>
            </view>
            
            <view class="cert-upload-item">
              <text class="upload-section-title">请上传其他证书</text>
              <view class="personal-cert-upload-area" bindtap="uploadOtherCert2">
                <image wx:if="{{certData.otherCert2Image}}" class="cert-uploaded-image" src="{{certData.otherCert2Image}}"></image>
                <view wx:else class="cert-upload-placeholder">
                  <image class="cert-placeholder-icon" src="/images/cert-icon.svg"></image>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <view class="next-btn" bindtap="goToNextStep">
        提交认证
      </view>
    </view>
  </view>

  <!-- 企业认证内容 -->
  <view class="enterprise-cert" wx:if="{{currentTab === 'enterprise'}}">
    <!-- 认证步骤 -->
    <view class="cert-steps">
      <view class="step-item {{currentStep === 'photo' ? 'active' : ''}}" bindtap="goToStep" data-step="photo">
        <view class="step-content-wrapper">
          <view class="step-icon">🏢</view>
          <text class="step-text">企业信息</text>
        </view>
      </view>
      <view class="step-line"></view>
      <view class="step-item {{currentStep === 'basic' ? 'active' : ''}}" bindtap="goToStep" data-step="basic">
        <view class="step-content-wrapper">
          <view class="step-icon">📄</view>
          <text class="step-text">资料上传</text>
        </view>
      </view>
      <view class="step-line"></view>
      <view class="step-item {{currentStep === 'identity' ? 'active' : ''}}" bindtap="goToStep" data-step="identity">
        <view class="step-content-wrapper">
          <view class="step-icon">👤</view>
          <text class="step-text">法人认证</text>
        </view>
      </view>
    </view>

    <!-- 步骤1: 企业信息 -->
    <view class="step-content" wx:if="{{currentStep === 'photo'}}">
      <view class="upload-section">
        <text class="section-title">上传企业形象照片</text>
        <view class="enterprise-upload-area" bindtap="uploadPhoto">
          <image wx:if="{{enterpriseData.companyLogo}}" class="enterprise-uploaded-image" src="{{enterpriseData.companyLogo}}"></image>
          <view wx:else class="enterprise-upload-placeholder">
            <image class="enterprise-bg-image" src="https://meizhitong-1360563549.cos.ap-chengdu.myqcloud.com/images/uploads/11b9afd55ed8eb760380365b38d207d9.png"></image>
            <view class="upload-icon">+</view>
            <text class="placeholder-text">上传形象照片</text>
          </view>
        </view>
      </view>
      
      <view class="form-section">
        <view class="form-item">
          <text class="form-label">企业名称</text>
          <input class="form-input" placeholder="请输入企业名称" data-field="companyName" bindinput="inputEnterpriseChange" value="{{enterpriseData.companyName}}" />
        </view>
        
        <view class="form-item">
          <text class="form-label">所在地区</text>
          <picker mode="region" bindchange="enterpriseRegionChange" value="{{enterpriseRegion}}">
            <view class="picker-input {{!enterpriseRegion[0] ? 'placeholder' : ''}}">
              {{enterpriseRegion[0] ? enterpriseRegion[0] + ' ' + enterpriseRegion[1] + ' ' + enterpriseRegion[2] : '请选择所在地区'}}
              <view class="picker-arrow">▾</view>
            </view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">企业类型</text>
          <picker bindchange="enterpriseTypeChange" value="{{enterpriseTypeIndex}}" range="{{enterpriseTypes}}">
            <view class="picker-input {{!enterpriseTypes[enterpriseTypeIndex] ? 'placeholder' : ''}}">
              {{enterpriseTypes[enterpriseTypeIndex] || '请选择企业类型'}}
              <view class="picker-arrow">▾</view>
            </view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">所属领域</text>
          <picker bindchange="enterpriseFieldChange" value="{{enterpriseFieldIndex}}" range="{{enterpriseFields}}">
            <view class="picker-input {{!enterpriseFields[enterpriseFieldIndex] ? 'placeholder' : ''}}">
              {{enterpriseFields[enterpriseFieldIndex] || '请选择所属领域'}}
              <view class="picker-arrow">▾</view>
            </view>
          </picker>
        </view>
      </view>
      
      <view class="next-btn" bindtap="goToNextStep">
        下一步
      </view>
    </view>

    <!-- 步骤2: 资料上传 -->
    <view class="step-content" wx:if="{{currentStep === 'basic'}}">
      <view class="cert-upload-section">
        <text class="upload-section-title">营业执照照片 *</text>
        <text class="upload-tip">支持jpg/png格式，文件大小在2M以内</text>
        
        <view class="cert-upload-area" bindtap="uploadBusinessLicense">
          <image wx:if="{{enterpriseData.businessLicense}}" class="cert-uploaded-image" src="{{enterpriseData.businessLicense}}"></image>
          <view wx:else class="cert-upload-placeholder">
            <text class="cert-placeholder-text">营业执照</text>
          </view>
        </view>
        <view class="upload-btn" bindtap="uploadBusinessLicense">上传营业执照</view>
      </view>
      
      <view class="cert-upload-section">
        <text class="upload-section-title">医疗许可证照片 *</text>
        <text class="upload-tip">支持jpg/png格式，文件大小在2M以内</text>
        
        <view class="cert-upload-area" bindtap="uploadMedicalLicense">
          <image wx:if="{{enterpriseData.medicalLicense}}" class="cert-uploaded-image" src="{{enterpriseData.medicalLicense}}"></image>
          <view wx:else class="cert-upload-placeholder">
            <text class="cert-placeholder-text">医疗许可证</text>
          </view>
        </view>
        <view class="upload-btn" bindtap="uploadMedicalLicense">上传医疗许可证</view>
      </view>
      
      <view class="cert-upload-section">
        <text class="upload-section-title">医疗器械经营许可证照片</text>
        <text class="upload-tip">支持jpg/png格式，文件大小在2M以内</text>
        
        <view class="cert-upload-area" bindtap="uploadDeviceLicense">
          <image wx:if="{{enterpriseData.deviceLicense}}" class="cert-uploaded-image" src="{{enterpriseData.deviceLicense}}"></image>
          <view wx:else class="cert-upload-placeholder">
            <text class="cert-placeholder-text">医疗器械经营许可证</text>
          </view>
        </view>
        <view class="upload-btn" bindtap="uploadDeviceLicense">上传医疗器械经营许可证</view>
      </view>
      
      <view class="next-btn" bindtap="goToNextStep">
        下一步
      </view>
    </view>

    <!-- 步骤3: 法人认证 -->
    <view class="step-content" wx:if="{{currentStep === 'identity'}}">
      <view class="cert-upload-section">
        <text class="upload-section-title">法人证件照片 *</text>
        <text class="upload-tip">请上传证件正反面照，支持jpg/png格式，文件大小在2M以内</text>
        
        <view class="cert-upload-grid">
          <view class="cert-upload-item">
            <view class="legal-person-upload-area" bindtap="uploadLegalPersonIdFront">
              <image wx:if="{{enterpriseData.legalPersonIdFront}}" class="cert-uploaded-image" src="{{enterpriseData.legalPersonIdFront}}"></image>
              <view wx:else class="cert-upload-placeholder">
                <image class="cert-placeholder-icon" src="/images/id-front-icon.svg"></image>
              </view>
            </view>
            <text class="cert-upload-label">上传正面照</text>
          </view>
          
          <view class="cert-upload-item">
            <view class="legal-person-upload-area" bindtap="uploadLegalPersonIdBack">
              <image wx:if="{{enterpriseData.legalPersonIdBack}}" class="cert-uploaded-image" src="{{enterpriseData.legalPersonIdBack}}"></image>
              <view wx:else class="cert-upload-placeholder">
                <image class="cert-placeholder-icon" src="/images/id-back-icon.svg"></image>
              </view>
            </view>
            <text class="cert-upload-label">上传反面照</text>
          </view>
        </view>
      </view>
      
      <view class="form-section">
        <view class="form-item">
          <text class="form-label">法人姓名 *</text>
          <input class="form-input" placeholder="请输入法人姓名" data-field="legalPersonName" bindinput="inputEnterpriseChange" value="{{enterpriseData.legalPersonName}}" />
        </view>
        
        <view class="form-item">
          <text class="form-label">法人证件号码 *</text>
          <input class="form-input" placeholder="请输入法人证件号" data-field="legalPersonId" bindinput="inputEnterpriseChange" value="{{enterpriseData.legalPersonId}}" />
        </view>
        
        <view class="form-item">
          <text class="form-label">开户银行</text>
          <input class="form-input" placeholder="请输入开户银行" data-field="bankName" bindinput="inputEnterpriseChange" value="{{enterpriseData.bankName}}" />
        </view>
        
        <view class="form-item">
          <text class="form-label">银行账户</text>
          <input class="form-input" placeholder="请输入银行账户" data-field="bankAccount" bindinput="inputEnterpriseChange" value="{{enterpriseData.bankAccount}}" />
        </view>
      </view>
      
      <view class="agreement-section">
          <view class="agreement-checkbox {{enterpriseData.agreeTerms ? 'checked' : ''}}" bindtap="toggleAgreeTerms">
            <text class="checkbox-icon">{{enterpriseData.agreeTerms ? '✓' : ''}}</text>
          </view>
          <text class="agreement-text">我已阅读并同意 </text>
          <text class="agreement-link">《企业认证用户协议》</text>
        </view>
      
      <view class="next-btn" bindtap="goToNextStep">
        提交认证
      </view>
    </view>
  </view>
</view>