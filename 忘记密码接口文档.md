# 忘记密码功能后端接口文档

## 1. 发送短信验证码接口

### 接口信息
- **接口路径**: `POST /auth/send-sms`
- **接口描述**: 发送短信验证码到指定手机号
- **是否需要认证**: 否

### 请求参数
```json
{
  "phone": "13800138000"
}
```

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| phone | string | 是 | 手机号码，11位数字 |

### 响应格式
**成功响应 (200)**:
```json
{
  "code": 200,
  "message": "验证码发送成功",
  "data": {
    "smsKey": "sms_key_123456789",
    "expireTime": 300
  }
}
```

**失败响应 (400)**:
```json
{
  "code": 400,
  "message": "手机号格式错误"
}
```

### 响应字段说明
| 字段名 | 类型 | 说明 |
|--------|------|------|
| smsKey | string | 短信验证码标识，用于验证时传递 |
| expireTime | number | 验证码有效期（秒） |

---

## 2. 重置密码接口

### 接口信息
- **接口路径**: `POST /auth/reset-password`
- **接口描述**: 通过短信验证码重置用户密码
- **是否需要认证**: 否

### 请求参数
```json
{
  "phone": "13800138000",
  "smsCode": "123456",
  "password": "newpassword123",
  "smsKey": "sms_key_123456789"
}
```

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| phone | string | 是 | 手机号码，11位数字 |
| smsCode | string | 是 | 短信验证码，6位数字 |
| password | string | 是 | 新密码，至少6位 |
| smsKey | string | 是 | 短信验证码标识 |

### 响应格式
**成功响应 (200)**:
```json
{
  "code": 200,
  "message": "密码重置成功",
  "data": {
    "success": true
  }
}
```

**失败响应示例**:

**验证码错误 (400)**:
```json
{
  "code": 400,
  "message": "验证码错误或已过期"
}
```

**用户不存在 (404)**:
```json
{
  "code": 404,
  "message": "该手机号未注册"
}
```

**参数错误 (400)**:
```json
{
  "code": 400,
  "message": "密码格式不正确，至少6位"
}
```

---

## 3. 接口调用流程

1. **用户输入手机号** → 调用发送短信验证码接口
2. **用户输入验证码和新密码** → 调用重置密码接口
3. **重置成功** → 返回登录页面

## 4. 错误处理

### 通用错误码
| 错误码 | 说明 |
|--------|------|
| 200 | 成功 |
| 400 | 请求参数错误 |
| 404 | 资源不存在 |
| 429 | 请求过于频繁 |
| 500 | 服务器内部错误 |

### 短信验证码限制
- 同一手机号1分钟内只能发送1次验证码
- 验证码有效期为5分钟
- 验证码错误次数超过5次后，需要重新获取验证码

## 5. 安全要求

1. **频率限制**: 同一IP地址每小时最多发送10次验证码
2. **验证码复杂度**: 6位随机数字
3. **密码要求**: 至少6位，建议包含字母和数字
4. **日志记录**: 记录所有密码重置操作的日志

## 6. 数据库设计建议

### 短信验证码表 (sms_codes)
```sql
CREATE TABLE sms_codes (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  phone VARCHAR(11) NOT NULL COMMENT '手机号',
  code VARCHAR(6) NOT NULL COMMENT '验证码',
  sms_key VARCHAR(50) NOT NULL COMMENT '验证码标识',
  type VARCHAR(20) NOT NULL COMMENT '验证码类型：reset_password',
  expire_time DATETIME NOT NULL COMMENT '过期时间',
  used TINYINT DEFAULT 0 COMMENT '是否已使用：0-未使用，1-已使用',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_phone_type (phone, type),
  INDEX idx_sms_key (sms_key)
);
```

### 用户表更新
确保用户表中有以下字段：
- `phone`: 手机号（唯一索引）
- `password`: 密码（加密存储）
- `updated_at`: 更新时间

---

**注意事项**:
1. 所有密码必须进行加密存储（建议使用bcrypt）
2. 短信验证码使用后应立即标记为已使用
3. 建议添加操作日志记录密码重置行为
4. 生产环境需要接入真实的短信服务商